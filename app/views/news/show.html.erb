<div class="container-fluid">
  <table class="table table-striped table-bordered table-hover">
    <thead class="thead-light">
      <tr>
        <th class='tbl-head' colspan=6>NEWS</th>
      </tr>
      <tr>
        <th>ID</th>
        <th>TITLE</th>
        <th colspan=2>ARTICLE</th>
        <th>SUBSCRIBER</th>
      </tr>
    </thead>
    <tbody>
      <% @news.each do |e| %>
        <tr>
          <td><%= e.id %></td>
          <td><%= e.title %></td>
          <td>
            <%= e.article %><br>
            <img src="<%= e.image.url %>" alt="no-image" width="300"/>
          </td>
          <td><%= format_participants(e.subscriber) %></td>
          <td><a class="btn btn-danger" href="<%= news_delete_path(e.id) %>">Delete</a></td>
        </tr>
      <% end %>
      <tr>
        <%= form_tag(news_create_path, method: :post, id: 'news_form', multipart: true ) do %>
        <td><button class="btn btn-primary" type="submit">Create</button></td>
        <td>
          <input type="text" id="title" name="title" placeholder="Title">
        </td>
        <td>
          <textarea id="article" name="article" placeholder="Article Contents"></textarea>
          <%= file_field_tag 'image', accept: 'image/*' %>
        </td>
        <td colspan=2>
          <select id="campus" name="campus" onchange="getColleges(this)">
            <% @campus.each do |c| %>
              <option value='<%= c.id %>'><%= c.name.capitalize %></option>
            <% end %>
          </select>
          <select id="colleges" name="colleges" onchange="getCourses(this)">
          </select>
          <select id="courses" name="courses" onchange="getBatches(this)">
          </select>
          <select id="batches" name="batches">
          </select>
        </td>
        <% end %>
      </tr>
    </tbody>
  </table>
</div>

<script>
  function getColleges(elem) {
    $.ajax({
      url: '/election_participants/campus/' + elem.value,
      success: function(data, textStatus, jqXHR) {
        console.log(data);
        var colleges = $('#colleges');
        colleges.empty();
        data.forEach(function(item, index) {
          colleges.append($('<option>', { value: item.id, text: item.name}))
        });
      },
      error: function(jqXHR, textStatus, error) {
        console.log(error);
      }
    });
  }

  function getCourses(elem) {
    $.ajax({
      url: '/election_participants/college/' + elem.value,
      success: function(data, textStatus, jqXHR) {
        console.log(data);
        var colleges = $('#courses');
        colleges.empty();
        data.forEach(function(item, index) {
          colleges.append($('<option>', { value: item.id, text: item.course}))
        });
      },
      error: function(jqXHR, textStatus, error) {
        console.log(error);
      }
    });
  }

  function getBatches(elem) {
    $.ajax({
      url: '/election_participants/course/' + elem.value,
      success: function(data, textStatus, jqXHR) {
        console.log(data);
        var colleges = $('#batches');
        colleges.empty();
        data.forEach(function(item, index) {
          colleges.append($('<option>', { value: item.id, text: item.year}))
        });
      },
      error: function(jqXHR, textStatus, error) {
        console.log(error);
      }
    });
  }
</script>
